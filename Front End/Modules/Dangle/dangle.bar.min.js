/*! dangle - v1.0.0 - 2013-03-02
* http://www.fullscale.co/dangle
* Copyright (c) 2013 FullScale Labs, LLC; Licensed MIT */
angular.module("dangle").directive("fsBar",[function(){"user strict";return{restrict:"E",scope:{onClick:"=",width:"=",height:"=",bind:"=",duration:"@"},link:function(e,t,n){var r={top:10,right:10,bottom:10,left:10},i=e.width||300,s=e.height||1020;i=i-r.left-r.right,s=s-r.top-r.bottom;var o=n.class||"",u=n.align||"left",a=u==="right"?"xMaxYMin":"xMinYMin",f=d3.scale.linear().range([0,i]),l=d3.scale.ordinal().rangeBands([0,s],.1),c=d3.select(t[0]).append("svg").attr("preserveAspectRatio",a+" meet").attr("viewBox","0 0 "+(i+r.left+r.right)+" "+(s+r.top+r.bottom)).append("g").attr("transform","translate("+r.left+","+r.top+")");e.$watch("bind",function(t){var r=e.duration||0,s=e.delay||0,a=e.field||n.bind.split(".").pop().toLowerCase();if(t){t=t.terms||[],f.domain([0,d3.max(t,function(e){return e.count})*2]),l.domain(t.map(function(e){return e.term}));var h=c.selectAll("rect").data(t,function(e){return Math.random()});h.enter().append("rect").attr("class","bar rect "+o).attr("cursor","pointer").attr("y",function(e){return l(e.term)}).attr("height",l.rangeBand()).attr("x",function(e){return u==="right"?i:0}).transition().duration(r).attr("width",function(e){return f(e.count)}).attr("x",function(e){return u==="right"?i-f(e.count):0}),h.on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(a,t.term)})}),h.exit().remove();var p=c.selectAll("text").data(t,function(e){return Math.random()});p.enter().append("text").attr("class","bar text "+o).attr("cursor","pointer").attr("y",function(e){return l(e.term)+l.rangeBand()/2}).attr("x",function(e){return u==="right"?i-f(e.count)-3:f(e.count)+3}).attr("dy",".35em").attr("text-anchor",function(e){return u==="right"?"end":"start"}).text(function(e){return u==="right"?"("+e.count+") "+e.term:e.term+" ("+e.count+")"}),p.on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(a,t.term)})}),p.exit().remove()}})}}}]);