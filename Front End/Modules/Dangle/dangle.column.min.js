/*! dangle - v1.0.0 - 2013-03-02
* http://www.fullscale.co/dangle
* Copyright (c) 2013 FullScale Labs, LLC; Licensed MIT */
angular.module("dangle").directive("fsColumn",[function(){"use strict";return{restrict:"E",scope:{fontSize:"=",onClick:"=",width:"=",height:"=",bind:"="},link:function(e,t,n){var r={top:20,right:20,bottom:30,left:40},i=e.width||960,s=e.height||500,o=n.color||"steelblue",u=n.fontColor||"#000",a=e.fontSize||14,f=n.label||"Frequency";n.field==undefined&&(n.field=n.bind.split(".").pop().toLowerCase()),i=i-r.left-r.right,s=s-r.top-r.bottom;var l=d3.scale.ordinal().rangeRoundBands([0,i],.1),c=d3.scale.linear().range([s,0]),h=d3.svg.axis().scale(l).orient("bottom"),p=d3.svg.axis().scale(c).orient("left"),d=d3.select(t[0]).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(i+r.left+r.right)+" "+(s+r.top+r.bottom)).append("g").attr("transform","translate("+r.left+","+r.top+")");e.$watch("bind",function(t){t&&(t=t.terms||[],d.selectAll("*").remove(),l.domain(t.map(function(e){return e.term})),c.domain([0,d3.max(t,function(e){return e.count})]),d.append("g").attr("fill",u).attr("font-size",a).attr("class","x axis").attr("transform","translate(0,"+s+")").call(h),d.append("g").attr("class","y axis").attr("font-size",a).attr("fill",u).call(p).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".51em").style("text-anchor","end").text(f),d.selectAll(".bar").data(t).enter().append("rect").attr("fill",o).attr("x",function(e){return l(e.term)}).attr("width",l.rangeBand()).attr("y",function(e){return c(e.count)}).attr("height",function(e){return s-c(e.count)}).on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(n.field,t.term)})}))})}}}]);