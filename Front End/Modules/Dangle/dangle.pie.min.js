/*! dangle - v1.0.0 - 2013-03-02
* http://www.fullscale.co/dangle
* Copyright (c) 2013 FullScale Labs, LLC; Licensed MIT */
angular.module("dangle").directive("fsPie",[function(){"use strict";return{restrict:"E",scope:{outerRadius:"=",innerRadius:"=",fontSize:"=",domain:"=",colorMap:"=",onClick:"=",bind:"="},link:function(e,t,n){var r=e.outerRadius||200,i=e.innerRadius||0,s=e.fontSize||14,o=n.fontColor||"#fff",u=undefined;n.field==undefined&&(n.field=n.bind.split(".").pop().toLowerCase()),e.colorMap==undefined?(u=d3.scale.category20c(),e.domain!==undefined&&u.domain(e.domain)):u=function(t){return e.colorMap[t]};var a=d3.svg.arc().outerRadius(r-10).innerRadius(i),f=d3.layout.pie().sort(null).value(function(e){return e.count}),l=d3.select(t[0]).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+r*2+" "+r*2).append("g").attr("transform","translate("+r+","+r+") rotate(180) scale(-1, -1)");e.$watch("bind",function(t){if(t){t=t.terms||[],l.selectAll("*").remove();var r=l.selectAll(".arc").data(f(t)).enter().append("g").attr("class","arc").on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(n.field,t.data.term)})});r.append("path").attr("d",a).style("fill",function(e){return u(e.data.term)}),r.append("text").attr("transform",function(e){return"translate("+a.centroid(e)+")"}).attr("dy",".55em").style("text-anchor","middle").attr("fill",o).attr("font-size",s).text(function(e){return e.data.term})}})}}}]);