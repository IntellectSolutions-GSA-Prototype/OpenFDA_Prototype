/*! dangle - v1.0.0 - 2013-03-02
* http://www.fullscale.co/dangle
* Copyright (c) 2013 FullScale Labs, LLC; Licensed MIT */
angular.module("dangle").directive("fsArea",[function(){"use strict";return{restrict:"E",scope:{onClick:"=",width:"=",height:"=",bind:"=",label:"@",field:"@",duration:"@",delay:"@",plot:"@",pointRadius:"@"},link:function(e,t,n){var r={top:20,right:20,bottom:30,left:80},i=e.width||1280,s=e.height||300,o=n.interpolate||"false",u=n.label||"Frequency",a=n.class||"";i=i-r.left-r.right,s=s-r.top-r.bottom;var f=d3.time.scale().range([0,i]),l=d3.scale.linear().range([s,0]),c=d3.svg.axis().scale(f).orient("bottom"),h=d3.svg.axis().scale(l).orient("left"),p=d3.svg.line().x(function(e){return f(e.time)}).y(function(e){return l(e.count)}),d=d3.svg.area().x(function(e){return f(e.time)}).y0(s).y1(function(e){return l(e.count)});n.interpolate=="true"&&(p.interpolate("cardinal"),d.interpolate("cardinal"));var v=d3.select(t[0]).append("svg").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+(i+r.left+r.right)+" "+(s+r.top+r.bottom)).append("g").attr("transform","translate("+r.left+","+r.top+")");v.append("path").datum([]).attr("class","area fill "+a).attr("d",d),v.append("g").attr("class","area x axis "+a).attr("transform","translate(0,"+s+")").call(c),v.append("g").attr("class","area y axis "+a).call(h).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(u),v.append("path").datum([]).attr("class","area line "+a).attr("d",p),e.$watch("bind",function(t){var r=e.duration||0,i=e.delay||0,s=e.plot||"true",o=e.pointRadius||8,u=e.field||n.bind.split(".").pop().toLowerCase();if(t){t=t.entries||[],f.domain(d3.extent(t,function(e){return e.time})),l.domain([0,d3.max(t,function(e){return e.count})]);var m=v.transition().duration(r);m.select(".area").attr("d",d(t)),m.select(".line").attr("d",p(t));if(s=="true"){var g=v.selectAll("circle").data(t.filter(function(e){return e.count}),function(e){return Math.random()});g.enter().append("circle").attr("class","area line points "+a).attr("cursor","pointer").attr("cx",p.x()).attr("cy",p.y()).style("opacity",0).transition().duration(r).style("opacity",1).attr("cx",p.x()).attr("cy",p.y()).attr("r",o),g.on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(u,t.time)})}),g.exit().remove()}m.select(".x").call(c),m.select(".y").call(h)}})}}}]);